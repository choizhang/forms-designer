<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script type="text/javascript" src="../internal.js"></script>
    <style type="text/css">
        .section {
            margin-top: 10px;
            text-align: left;
            margin-left: 50px;
        }
        .section input {
            margin-left: 5px;
            width: 110px;
        }
    </style>
</head>
<body>
<div class="section">
    <div>
        <span><var id="lang_tdBkColor"></var></span>
        <!--<input type="text" id="J_tone"/>-->
        <input type="color" id="J_tone">
    </div>

    <div>
        <label>间距(1px 2px 3px 4px对应上右下左): <br><input type="text" id="padding" value="1px 2px 3px 4px"></label>
    </div>

    <div>
        <label>权限设置: <br>
            <select name="" id="power">
                <option value="1">普通</option>
                <option value="2">经理</option>
                <option value="3">管理员</option>
            </select>
        </label>
    </div>
</div>
<script src="../../third-party/jquery-1.10.2.js"></script>
<script type="text/javascript">
    var tone = $G("J_tone")
//            ,
//            colorPiker = new UE.ui.ColorPicker({
//                editor:editor
//            }),
//            colorPop = new UE.ui.Popup({
//                editor:editor,
//                content:colorPiker
//            });
    var padding = $G('padding');
    var power = $G('power');

//    domUtils.on(tone, "click", function () {
//        colorPop.showAnchor(tone);
//    });
//    domUtils.on(document, 'mousedown', function () {
//        colorPop.hide();
//    });
//    colorPiker.addListener("pickcolor", function () {
//        tone.value = arguments[1];
//        colorPop.hide();
//    });
////    清空颜色
//    colorPiker.addListener("picknocolor", function () {
//        tone.value="";
//        colorPop.hide();
//    });
    dialog.onok=function(){
        editor.execCommand("edittd",tone.value, padding.value, power.value);
    };

    var start = editor.selection.getStart(),
        cell = start && domUtils.findParentByTagName(start, ["td", "th"], true);
//    即使选择了多个,这里的cell也只是第一个
    if(cell){
//        设置初始值
//        如果使用会把js和css的设置都用上,但是在选中单元格进行设置的时候背景回发生错误
        var color = domUtils.getComputedStyle(cell,'background-color');
        var settringColor = rgb2hex(cell.style.backgroundColor);
        if(/^#/.test(color)){
            tone.value = settringColor
        }

//        间距
        var paddingNow = domUtils.getComputedStyle(cell,'padding');
        padding.value = paddingNow;

//        权限
        var powerNow = $(cell).attr('data-power');
        power.value = powerNow ? powerNow : 1;

    }

    function rgb2hex(rgb) {
//        第一次没有设置的时候,rgb不存在
        if(!rgb) return '';
        rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
        function hex(x) {
            return ("0" + parseInt(x).toString(16)).slice(-2);
        }
        return "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
    }

</script>
</body>
</html>